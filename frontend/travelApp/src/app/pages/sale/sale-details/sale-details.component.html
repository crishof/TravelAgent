<div class="container mt-4">
  <!-- Información del pasajero y cotización -->
  <div class="card mb-4">
    <div class="card-header">
      <h4>Trip Details</h4>
      <p>Travel id: {{ sale?.id }}</p>
    </div>
    <div class="card-body">
      @if(isLoading){
      <h2>Loading...</h2>
      }@else{
      <p>
        <strong>Passenger:</strong>
        {{ sale.customerResponse?.lastname }}, {{ sale.customerResponse?.name }}
      </p>
      <p>
        <strong>Trip date:</strong>
        {{ sale.travelDate | date : "dd/MM/yyyy" }}
      </p>
      <p>
        <strong>Description:</strong>
        {{ sale.description }}
      </p>
      <p>
        <strong>Sale Amount:</strong>
        {{ sale.amount | currency : sale.currency }}
      </p>
      }
    </div>
  </div>

  <!-- Tabla de servicios contratados -->
  <div class="card mb-4">
    <div class="card-header">
      <h5>Reservations</h5>
    </div>
    <div class="card-body">
      @if(isLoading){
      <h2>Loading...</h2>
      }@else{
      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>Supplier</th>
            <th>Booking Number</th>
            <th>Booking Date</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Currency</th>
            <th>Paid</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let service of sale.services">
            <td>{{ service.supplierId }}</td>
            <td>{{ service.bookingNumber }}</td>
            <td>{{ service.reservationDate | date : "dd/MM/yyyy" }}</td>
            <td>{{ service.description }}</td>
            <td>{{ service.amount | currency : service.currency }}</td>
            <td>{{ service.currency }}</td>
            <td>{{ service.paid ? "Yes" : "No" }}</td>
          </tr>
        </tbody>
      </table>
      }
    </div>
  </div>

  <!-- Tabla de pagos realizados -->
  <div class="card mb-4">
    <div class="card-header d-flex align-items-center">
      <h5>Payments</h5>
      <button
        type="button"
        class="btn btn-success ms-3"
        (click)="togglePaymentForm()"
      >
        New
      </button>
    </div>
    <div class="card-body">
      @if(isAddingPayment){
      <form (ngSubmit)="addPayment()">
        <div class="row g-3 align-items-center">
          <div class="col-md-2 mb-3">
            <label for="amount" class="form-label">Amount</label>
            <input
              type="number"
              id="amount"
              class="form-control"
              [(ngModel)]="newPayment.amount"
              name="amount"
              required
            />
          </div>
          <div class="col-md-2 mb-3">
            <label for="currency" class="form-label">Currency</label>
            <select
              id="currency"
              class="form-select"
              [(ngModel)]="newPayment.currency"
              name="currency"
              required
            >
              <option value="">Select Currency</option>
              <option value="USD">USD</option>
              <option value="EURO">EURO</option>
            </select>
          </div>
          <div class="col-md-4 mb-3">
            <label for="paymentMethod" class="form-label">Payment Method</label>
            <input
              type="text"
              id="paymentMethod"
              class="form-control"
              [(ngModel)]="newPayment.paymentMethod"
              name="paymentMethod"
              required
            />
          </div>
          <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary me-2">Save</button>
            <button
              type="button"
              class="btn btn-danger"
              (click)="togglePaymentForm()"
            >
              Cancel
            </button>
          </div>
        </div>
      </form>
      }

      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Amount</th>
            <th>Payment Method</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of payments">
            <td>{{ payment.paymentDate | date : "dd/MM/yyyy" }}</td>
            <td>{{ payment.currency }} {{ payment.amount }}</td>
            <td>{{ payment.paymentMethod }}</td>
          </tr>
        </tbody>
      </table>
      <p class="mt-3">
        <strong>Pending Balance:</strong>
        {{ pendingBalance | currency : sale?.currency }}
      </p>
    </div>
    <a class="btn btn-danger m-3 col-2" (click)="goBack()"> Back </a>
  </div>
</div>
